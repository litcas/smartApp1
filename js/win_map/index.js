apiready=function(){api.addEventListener({name:"keyback"},function(t,i){api.toLauncher()}),api.hideProgress(),apiready_init(),vm.aMap=api.require("aMap"),vm.$mount("#wrap")};var vm=new Vue({data:{aMap:null,searchValue:"",mapHeaderHeight:"",pois:[],overlayIds:[],fwcxing:!1,fwcxPoint:[]},watch:{searchValue:function(t){""===t&&this.removeAnnotations()}},methods:{init:function(){var n=this;this.aMap.open({rect:{x:0,y:this.mapHeaderHeight,w:"auto",h:"auto"},showUserLocation:!0,zoomLevel:11,center:{lon:111.66211712479296,lat:26.12246530334488},fixedOn:api.frameName,fixed:!0},function(t,i){t.status&&(n.aMap.setMapAttr({type:"standard",trafficOn:!1,zoomEnable:!0,scrollEnable:!0,overlookEnabled:!1,rotateEnabled:!1}),n.aMap.showUserLocation({isShow:!0}),n.getLocation())})},setMapAttr:function(t){this.aMap.setMapAttr({type:t,trafficOn:!1,zoomEnable:!0,scrollEnable:!0,overlookEnabled:!1,rotateEnabled:!1})},getLocation:function(){var n=this;this.aMap.getLocation(function(t,i){t.status?n.aMap.setCenter({coords:{lon:t.lon,lat:t.lat},animation:!1}):alert(JSON.stringify(i))})},openDrawerPane:function(){api.openDrawerPane({type:"left"})},removeAnnotations:function(){this.aMap.removeAnnotations({ids:null})},onSearch:function(){var n=this;this.removeAnnotations(),this.aMap.searchInCity({city:"长沙",keyword:this.searchValue,offset:8,page:1,sortrule:0},function(t){if(t.status){var i=t.pois;i=i.map(function(t){return{id:t.uid,lon:t.lon,lat:t.lat,draggable:!1,w:100,h:100,name:t.name}}),0<(n.pois=i).length&&(n.aMap.setCenter({coords:{lon:i[0].lon,lat:i[0].lat},animation:!1}),n.aMap.setZoomLevel({level:18,animation:!1}),n.addAnnotations(i))}})},addAnnotations:function(t){var i=this;this.aMap.addAnnotations({annotations:t},function(t){if("click"==t.eventType)t.id}),setTimeout(function(){i.setBubble(t)},1500)},setBubble:function(t){var n=this;t.map(function(i){n.aMap.annotationExist({id:i.id},function(t){t.status&&n.aMap.setBubble({id:i.id,content:{title:i.name},styles:{titleColor:"#000",titleSize:10,subTitleColor:"#000",subTitleSize:10,illusAlign:"left"}},function(t){t&&n.aMap.closeBubble({id:t.id})})})})},onClear:function(){this.removeAnnotations()},clearYwtc:function(){this.aMap.removeOverlay({ids:this.overlayIds}),this.overlayIds=[]},ywtcSumit:function(){var r=this;this.clearYwtc();var t=api.getGlobalData({key:"ywtcResult"}),i=t.accesspoint+"/"+t.title;this.ywtc_ajax(i).then(function(t){for(var i=t.features,n=0;n<i.length;n++)for(var a=i[n],e=a.geometry.rings,o=0;o<e.length;o++){var s=e[o].map(function(t){return{lon:t[0],lat:t[1]}});r.aMap.addPolygon({id:a.uid,styles:{borderColor:"#FF0000",borderWidth:3,lineDash:!1,fillColor:"#ff0"},points:s}),r.overlayIds.push(a.uid)}}),api.showProgress({title:"加载图层中...",modal:!0}),setTimeout(function(){api.hideProgress()},1500)},fwcxCLick:function(){var i=this;this.fwcxing=!0,this.aMap.setRect({rect:{x:0,y:80,w:"auto",h:"auto"}}),this.aMap.addEventListener({name:"click"},function(t){t.status&&(i.fwcxPoint.push({lon:t.lon,lat:t.lat}),i.aMap.addCircle({id:"point-"+i.fwcxPoint.length,center:{lon:t.lon,lat:t.lat},radius:120,styles:{borderColor:"#FF0000",borderWidth:5,lineDash:!1,fillColor:"#FF0000"}}),1<i.fwcxPoint.length&&i.aMap.addLine({id:"line-"+i.fwcxPoint.length-1,styles:{type:"arrow",borderColor:"#FF0000",borderWidth:8,lineDash:!1},points:[i.fwcxPoint[i.fwcxPoint.length-2],i.fwcxPoint[i.fwcxPoint.length-1]]}))})},fwcxComplete:function(){var t=this;2<this.fwcxPoint.length?(this.fwcxPoint.push(this.fwcxPoint[0]),this.aMap.addLine({id:"line-"+this.fwcxPoint.length-1,styles:{type:"arrow",borderColor:"#FF0000",borderWidth:8,lineDash:!1},points:[this.fwcxPoint[this.fwcxPoint.length-2],this.fwcxPoint[this.fwcxPoint.length-1]]}),setTimeout(function(){t.openWin("win_cloudquery_resultshow",t.fwcxPoint)},100)):this.$notify({type:"warning",message:"最少请绘制3个坐标点"})},fwcxCancal:function(){this.fwcxing=!1,this.fwcxPoint=[],this.aMap.setRect({rect:{x:0,y:this.mapHeaderHeight,w:"auto",h:"auto"}}),this.aMap.removeEventListener({name:"click"}),this.removeAnnotations()},fwcxClear:function(){this.removeAnnotations(),this.fwcxPoint=[]}},mounted:function(){this.mapHeaderHeight=$api.fixTabBar($api.byId("map-header")),this.init(),init_arcgis_ajax()}});