apiready=function(){apiready_init(),(aMapLBS=api.require("aMapLBS"))&&aMapLBS.configManager({accuracy:"best",filter:1},function(e,a){e.status&&aMapLBS.singleLocation({timeout:10},function(e,a){e.status&&(api.setGlobalData({key:"lat",value:e.lat}),api.setGlobalData({key:"lon",value:e.lon}))})}),api.addEventListener({name:"keyback"},function(e,a){api.toLauncher()}),api.removePrefs({key:"token"});api.getPrefs({sync:!0,key:"username"}),api.getPrefs({sync:!0,key:"pwd"});vm.winHeight=api.winHeight,vm._isMounted||vm.$mount("#wrap")};var aMapLBS=null,vm=new Vue({data:{username:"test1",pwd:"123456",sumitAllow:!0,winHeight:0,btnDisabled:!1},methods:{openFindpwd:function(){this.openWin("win_findpwd")},openRegister:function(){this.openWin("win_register")},getOrgan:function(){this.$ajax.get("/api/admin/depart/getZhgdDepartTree").then(function(e){api.setGlobalData({key:"organ",value:JSON.stringify(e.data.data)})}).catch(function(e,a){})},getAuth:function(){this.$ajax({url:"/api/admin/user/front/appinfo",method:"get"}).then(function(e){for(var a=e.data,t={},n=0;n<a.menus.length;n++)t[a.menus[n].code]=!0;var i={};for(n=0;n<a.elements.length;n++)i[a.elements[n].code]=!0;api.setGlobalData({key:"auth_menus",value:t}),api.setGlobalData({key:"auth_elements",value:i})})},login:debounce(function(){var n=this;if(this.sumitAllow)if(this.username){if(this.pwd)return this.btnDisabled=!0,api.showProgress({title:"登录中...",modal:!1}),new Promise(function(e,a){var t={__login:!0,_ajax:"json",username:n.username,password:n.pwd};n.$ajax({url:"/pl/a/login",method:"get",params:t}).then(function(e){"false"!==e.data.result?(api.setPrefs({key:"username",value:n.username}),api.setPrefs({key:"pwd",value:n.pwd}),api.setGlobalData({key:"token",value:e.data.sessionid}),api.openDrawerLayout({edge:30,name:"win_map",url:"../win_map/index.html",animation:{type:"none"},leftPane:{name:"win_leftpane",url:"../win_leftpane/index.html",bgColor:"rgba(0,0,0,0.5)"}})):api.toast({msg:e.data.message,duration:5e3})}).catch(function(e){api.removePrefs({key:"uesrname"}),api.removePrefs({key:"pwd"}),$api.clearStorage(),400!==e.status?500!==e.status&&setTimeout(function(){api.clearCache(function(){api.rebootApp()})},2500):api.toast({msg:e.data.message,duration:3e3})}).finally(function(){api.hideProgress(),n.btnDisabled=!1})});api.toast({msg:"密码不能为空",duration:3e3})}else api.toast({msg:"用户名不能为空",duration:3e3})},400)},mounted:function(){}});